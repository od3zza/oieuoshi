<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt" lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Exemplo de Post com Comentários - Uoshi</title>
    <meta name="author" content="Uoshi" />
    <meta name="description" content="Exemplo de como integrar o sistema de comentários em um post do blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="alternate" type="application/rss+xml" href="/sitemap.xml" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="stylesheet" href="/lib/style.css" type="text/css" media="screen, projection" />
    <script src="/lib/script.js" defer></script>
    <meta name="theme-color" content="#ffffff" />
    <link rel="icon" type="image/png" href="https://cdn.glitch.global/5d620f50-0e74-4257-aa4d-114f5d987ec5/favicon.png?v=1727965698348" />
  </head>

  <body>
    <!-- Sidebar -->
    <div class="container"></div>
    <header class="sidebar">
      <div class="sidebar-text">
        <nav class="sections">
          <ul>
            <a href="/blog">← blog</a>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <!-- IMPORTANTE: Adicione data-post-id com um ID único para este post -->
    <section class="main" data-post-id="exemplo-post-comentarios">
      <sub>Dezembro 2024</sub>
      <h1>Exemplo de Post com Sistema de Comentários</h1>
      <br />
      <sub>tutorial</sub>
      <br /><br />

      <!-- Conteúdo do Post -->
      <p>
        Este é um exemplo de como integrar o sistema de comentários em um post do seu blog.
        O sistema utiliza Google Sheets para armazenar os comentários e Google Apps Script
        como backend.
      </p>

      <p>
        Cada post deve ter um ID único definido no atributo <code>data-post-id</code> da
        seção principal. No exemplo acima, usamos <code>exemplo-post-comentarios</code>.
      </p>

      <h2>Como funciona</h2>
      <p>
        Quando um visitante envia um comentário, os dados são enviados para o Google Apps Script,
        que valida e armazena as informações na planilha. Os comentários são então carregados
        dinamicamente via JavaScript.
      </p>

      <h2>Recursos incluídos</h2>
      <ul>
        <li>✅ Validação de dados</li>
        <li>✅ Sanitização contra XSS</li>
        <li>✅ Filtro de palavras banidas</li>
        <li>✅ Moderação opcional</li>
        <li>✅ Notificações por email</li>
        <li>✅ Design responsivo</li>
      </ul>

      <section class="footer"></section>

    <!-- 
    ALTERNATIVA: Se preferir definir o ID do post via JavaScript em vez do data-post-id,
    descomente o código abaixo e remova o atributo data-post-id da seção principal:
    
    <script>
      setPostId('exemplo-post-comentarios');
    </script>
    -->

    <!-- Sistema de Comentários -->
        <section class="comments-section">
            <!-- Formulário de comentários -->
            <div class="comments-form">
                <h3>Deixe seu comentário</h3>
                <div id="message-area"></div>
                <form id="comment-form">
                    <div class="form-group">
                        <label for="nome">Nome *</label>
                        <input type="text" id="nome" name="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="link">Website/Link (opcional)</label>
                        <input type="url" id="link" name="link" placeholder="https://exemplo.com">
                    </div>
                    <div class="form-group">
                        <label for="comentario">Comentário *</label>
                        <textarea id="comentario" name="comentario" required
                            placeholder="Escreva seu comentário aqui..."></textarea>
                    </div>
                    <button type="submit" class="btn-submit">Enviar Comentário</button>
                </form>
            </div>
            <!-- Lista de comentários -->
            <div class="comments-list">
                <h3>Comentários</h3>
                <div id="comments-container">
                    <div class="loading">Carregando comentários...</div>
                </div>
            </div>
        </section>

    </section>
    <hr />

    <form id="formComentario">
  <input type="text" id="nome" placeholder="Seu nome" required />
  <textarea id="mensagem" placeholder="Deixe um comentário" required></textarea>
  <button type="submit">Enviar</button>
</form>

<ul id="listaComentarios"></ul>

<script>
  const postagem = 'campo-comentarios-blog'; // slug da postagem
  const API_URL = 'https://oieuoshi.vercel.app'; // Substitua se necessário

  document.getElementById('formComentario').addEventListener('submit', async (e) => {
    e.preventDefault();
    const nome = document.getElementById('nome').value;
    const mensagem = document.getElementById('mensagem').value;

    await fetch(`${API_URL}/comentarios`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ nome, mensagem, postagem }),
    });

    document.getElementById('formComentario').reset();
    carregarComentarios();
  });

  async function carregarComentarios() {
    const res = await fetch(`${API_URL}/comentarios/${postagem}`);
    const comentarios = await res.json();

    const lista = document.getElementById('listaComentarios');
    lista.innerHTML = '';
    comentarios.forEach(({ nome, mensagem, criado_em }) => {
      const li = document.createElement('li');
      li.innerHTML = `<strong>${nome}</strong>: ${mensagem} <em>${new Date(criado_em).toLocaleString()}</em>`;
      lista.appendChild(li);
    });
  }

  carregarComentarios();
</script>

  </body>
</html>

